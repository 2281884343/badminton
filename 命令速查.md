# âš¡ å‘½ä»¤é€ŸæŸ¥è¡¨

## ğŸš€ å¿«é€Ÿéƒ¨ç½²ï¼ˆä¸‰æ­¥èµ°ï¼‰

```bash
# 1. èµ‹äºˆæ‰§è¡Œæƒé™
chmod +x deploy.sh start-dev.sh start-prod.sh

# 2. è¿è¡Œéƒ¨ç½²è„šæœ¬
./deploy.sh

# 3. å¯åŠ¨æœåŠ¡
./start-dev.sh        # å¼€å‘æ¨¡å¼
# æˆ–
./start-prod.sh       # ç”Ÿäº§æ¨¡å¼
```

## ğŸ“¦ æ‰‹åŠ¨å®‰è£…

### åç«¯
```bash
cd backend
python3 -m venv venv
source venv/bin/activate
pip install -r requirements.txt
mkdir -p data/players
python main.py
```

### å‰ç«¯
```bash
cd frontend
npm install
npm run dev           # å¼€å‘æ¨¡å¼
npm run build         # æ„å»ºç”Ÿäº§ç‰ˆæœ¬
```

## ğŸ”§ SystemdæœåŠ¡ç®¡ç†

```bash
# å®‰è£…æœåŠ¡
sudo cp badminton-game.service /etc/systemd/system/
sudo systemctl daemon-reload

# æœåŠ¡æ§åˆ¶
sudo systemctl start badminton-game      # å¯åŠ¨
sudo systemctl stop badminton-game       # åœæ­¢
sudo systemctl restart badminton-game    # é‡å¯
sudo systemctl status badminton-game     # çŠ¶æ€
sudo systemctl enable badminton-game     # å¼€æœºè‡ªå¯
sudo systemctl disable badminton-game    # ç¦ç”¨è‡ªå¯

# æŸ¥çœ‹æ—¥å¿—
sudo journalctl -u badminton-game -f     # å®æ—¶æ—¥å¿—
sudo journalctl -u badminton-game -n 100 # æœ€è¿‘100è¡Œ
```

## ğŸŒ Nginxé…ç½®

```bash
# æ„å»ºå‰ç«¯
cd frontend && npm run build

# éƒ¨ç½²é…ç½®
sudo cp nginx.conf /etc/nginx/sites-available/badminton-game
sudo ln -s /etc/nginx/sites-available/badminton-game /etc/nginx/sites-enabled/

# Nginxæ§åˆ¶
sudo nginx -t                    # æµ‹è¯•é…ç½®
sudo systemctl restart nginx     # é‡å¯
sudo systemctl reload nginx      # é‡è½½é…ç½®
sudo systemctl status nginx      # çŠ¶æ€

# æŸ¥çœ‹æ—¥å¿—
sudo tail -f /var/log/nginx/access.log
sudo tail -f /var/log/nginx/error.log
```

## ğŸ³ Dockerå‘½ä»¤

```bash
# æ„å»ºå¹¶å¯åŠ¨
docker-compose up -d

# æŸ¥çœ‹çŠ¶æ€
docker-compose ps

# æŸ¥çœ‹æ—¥å¿—
docker-compose logs -f

# åœæ­¢æœåŠ¡
docker-compose down

# é‡å¯æœåŠ¡
docker-compose restart

# è¿›å…¥å®¹å™¨
docker exec -it badminton-backend /bin/bash
```

## ğŸ”¥ é˜²ç«å¢™é…ç½®

### UFW (Ubuntu/Debian)
```bash
sudo ufw enable
sudo ufw allow 80/tcp
sudo ufw allow 443/tcp
sudo ufw allow 8000/tcp
sudo ufw allow 3000/tcp
sudo ufw status
```

### Firewalld (CentOS/RHEL)
```bash
sudo firewall-cmd --permanent --add-service=http
sudo firewall-cmd --permanent --add-service=https
sudo firewall-cmd --permanent --add-port=8000/tcp
sudo firewall-cmd --permanent --add-port=3000/tcp
sudo firewall-cmd --reload
sudo firewall-cmd --list-all
```

## ğŸ”’ SSLè¯ä¹¦ï¼ˆLet's Encryptï¼‰

```bash
# å®‰è£…certbot
sudo apt install certbot python3-certbot-nginx -y

# è·å–è¯ä¹¦
sudo certbot --nginx -d your-domain.com

# è‡ªåŠ¨ç»­æœŸï¼ˆæ·»åŠ åˆ°crontabï¼‰
sudo crontab -e
# æ·»åŠ : 0 3 * * * certbot renew --quiet
```

## ğŸ› æ•…éšœæ’æŸ¥

### æŸ¥çœ‹ç«¯å£å ç”¨
```bash
sudo lsof -i :8000
sudo lsof -i :3000
sudo netstat -tulnp | grep 8000
```

### ç»“æŸè¿›ç¨‹
```bash
# æŸ¥æ‰¾è¿›ç¨‹
ps aux | grep python
ps aux | grep node

# ç»“æŸè¿›ç¨‹
kill -9 <PID>

# æ‰¹é‡ç»“æŸ
pkill -f "python main.py"
pkill -f "npm run dev"
```

### æ£€æŸ¥æœåŠ¡çŠ¶æ€
```bash
# æ£€æŸ¥Python
python3 --version
which python3

# æ£€æŸ¥Node.js
node --version
npm --version

# æ£€æŸ¥è™šæ‹Ÿç¯å¢ƒ
source backend/venv/bin/activate
which python
pip list
```

### ç½‘ç»œæµ‹è¯•
```bash
# æµ‹è¯•åç«¯
curl http://localhost:8000/api/skills

# æµ‹è¯•å‰ç«¯
curl http://localhost:3000

# æµ‹è¯•APIå¯†é’¥
curl -X POST https://api.moonshot.cn/v1/chat/completions \
  -H "Authorization: Bearer YOUR_API_KEY" \
  -H "Content-Type: application/json" \
  -d '{"model": "kimi-k2-turbo-preview", "messages": [{"role": "user", "content": "test"}]}'
```

## ğŸ’¾ å¤‡ä»½å’Œæ¢å¤

### å¤‡ä»½
```bash
# å¤‡ä»½ç©å®¶æ•°æ®
tar -czf backup-$(date +%Y%m%d).tar.gz backend/data/players

# å¤‡ä»½æ•´ä¸ªé¡¹ç›®
tar -czf badminton-game-$(date +%Y%m%d).tar.gz \
  --exclude='node_modules' \
  --exclude='venv' \
  --exclude='__pycache__' \
  --exclude='dist' \
  .
```

### æ¢å¤
```bash
# æ¢å¤ç©å®¶æ•°æ®
tar -xzf backup-20240101.tar.gz -C /path/to/restore/

# æ¢å¤é¡¹ç›®
tar -xzf badminton-game-20240101.tar.gz
cd badminton-game
./deploy.sh
```

## ğŸ”„ æ›´æ–°åº”ç”¨

```bash
# æ‹‰å–æœ€æ–°ä»£ç 
git pull

# æ›´æ–°åç«¯
cd backend
source venv/bin/activate
pip install -r requirements.txt
cd ..

# æ›´æ–°å‰ç«¯
cd frontend
npm install
npm run build
cd ..

# é‡å¯æœåŠ¡
sudo systemctl restart badminton-game
sudo systemctl restart nginx
```

## ğŸ“Š ç›‘æ§å‘½ä»¤

```bash
# ç³»ç»Ÿèµ„æº
htop
top
free -h
df -h

# æŸ¥çœ‹è¿›ç¨‹
ps aux | grep python
ps aux | grep node

# ç½‘ç»œè¿æ¥
netstat -tulnp
ss -tulnp

# å®æ—¶æ—¥å¿—
tail -f backend/data/*.log
sudo journalctl -f
```

## ğŸ§¹ æ¸…ç†å‘½ä»¤

```bash
# æ¸…ç†Pythonç¼“å­˜
find . -type d -name "__pycache__" -exec rm -r {} +
find . -type f -name "*.pyc" -delete

# æ¸…ç†Node.js
cd frontend
rm -rf node_modules
npm cache clean --force
npm install

# æ¸…ç†æ„å»ºæ–‡ä»¶
rm -rf frontend/dist

# æ¸…ç†æ—¥å¿—ï¼ˆå°å¿ƒï¼‰
sudo truncate -s 0 /var/log/nginx/access.log
sudo truncate -s 0 /var/log/nginx/error.log
```

## ğŸ”‘ ç¯å¢ƒå˜é‡

```bash
# è®¾ç½®ä¸´æ—¶ç¯å¢ƒå˜é‡
export MOONSHOT_API_KEY=your-api-key

# è®¾ç½®æ°¸ä¹…ç¯å¢ƒå˜é‡ï¼ˆæ·»åŠ åˆ° ~/.bashrc æˆ– ~/.bash_profileï¼‰
echo 'export MOONSHOT_API_KEY=your-api-key' >> ~/.bashrc
source ~/.bashrc

# ä½¿ç”¨.envæ–‡ä»¶
cd backend
cp .env.example .env
nano .env  # ç¼–è¾‘é…ç½®
```

## ğŸ“ å¸¸ç”¨æ–‡ä»¶è·¯å¾„

```bash
# é…ç½®æ–‡ä»¶
/etc/nginx/sites-available/badminton-game
/etc/systemd/system/badminton-game.service
~/.bashrc

# æ—¥å¿—æ–‡ä»¶
/var/log/nginx/access.log
/var/log/nginx/error.log
sudo journalctl -u badminton-game

# æ•°æ®æ–‡ä»¶
backend/data/players/*.json

# é¡¹ç›®æ–‡ä»¶
/opt/badminton-game  # æ¨èçš„éƒ¨ç½²è·¯å¾„
```

## âš¡ æ€§èƒ½ä¼˜åŒ–

```bash
# ä½¿ç”¨gunicornå¯åŠ¨åç«¯ï¼ˆå¤šè¿›ç¨‹ï¼‰
cd backend
source venv/bin/activate
gunicorn main:app -w 4 -k uvicorn.workers.UvicornWorker -b 0.0.0.0:8000

# ä½¿ç”¨PM2ç®¡ç†å‰ç«¯ï¼ˆå¯é€‰ï¼‰
npm install -g pm2
pm2 start "npm run dev" --name badminton-frontend
pm2 save
pm2 startup

# Nginxç¼“å­˜é…ç½®ï¼ˆæ·»åŠ åˆ°nginx.confï¼‰
proxy_cache_path /var/cache/nginx levels=1:2 keys_zone=my_cache:10m;
```

## ğŸ¯ å¿«æ·è„šæœ¬

### ä¸€é”®é‡å¯æ‰€æœ‰æœåŠ¡
```bash
#!/bin/bash
sudo systemctl restart badminton-game
sudo systemctl restart nginx
echo "æœåŠ¡å·²é‡å¯"
```

### ä¸€é”®æŸ¥çœ‹æ‰€æœ‰æ—¥å¿—
```bash
#!/bin/bash
echo "=== åç«¯æ—¥å¿— ==="
sudo journalctl -u badminton-game -n 20
echo "=== Nginxé”™è¯¯æ—¥å¿— ==="
sudo tail -20 /var/log/nginx/error.log
```

### ä¸€é”®å¤‡ä»½
```bash
#!/bin/bash
BACKUP_DIR="/backup/badminton"
mkdir -p $BACKUP_DIR
DATE=$(date +%Y%m%d_%H%M%S)
tar -czf $BACKUP_DIR/backup_$DATE.tar.gz backend/data/players
echo "å¤‡ä»½å®Œæˆ: $BACKUP_DIR/backup_$DATE.tar.gz"
```

---

**ä¿å­˜è¿™ä¸ªæ–‡ä»¶ä»¥ä¾¿å¿«é€ŸæŸ¥æ‰¾å‘½ä»¤ï¼ğŸ“‹**

